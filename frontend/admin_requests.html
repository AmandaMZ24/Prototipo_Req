<!doctype html>
<html lang="es">
<head><meta charset="utf-8"><title>Solicitudes de Adopción - Admin</title><style>
    body {background-color: #f1ca49;}
  </style></head>
<body>
<script>
const API = "http://127.0.0.1:5000/requests/admin";
const token = localStorage.getItem("token");
(function checkAdmin() {
  const t = token; // usar directamente el token almacenado
  if (!t) { alert("Debes iniciar sesión como administrador"); location.href="login.html"; return; }
  try {
    const payload = JSON.parse(atob(t.split('.')[1]));
    // payload.role existe si backend lanzó additional_claims; si no, revisar payload.sub.role
    const role = payload.role || (payload.sub && payload.sub.role);
    if (role !== "admin") { alert("Acceso denegado"); location.href="pets.html"; }
  }
  catch(e){ alert("Token inválido"); location.href="login.html"; }
})();

async function loadRequests(){
  try {
    const res = await fetch(API, {
      headers: { "Authorization": `Bearer ${token}` }
    });
    if (!res.ok) throw new Error("No se pudieron obtener las solicitudes");
    const requests = await res.json();
    const listDiv = document.getElementById("list");
    if (requests.length === 0) {
      listDiv.innerHTML = "<p>No hay solicitudes de adopción.</p>";
      return;
    }
    const ul = document.createElement("ul");
    requests.forEach(r => {
      const li = document.createElement("li");
      li.innerHTML = `<strong>Solicitud ID:</strong> ${r.id} | <strong>Mascota ID:</strong> ${r.pet_id} | <strong>Usuario ID:</strong> ${r.user_id} | <strong>Fecha:</strong> ${new Date(r.request_date).toLocaleDateString()} | <strong>Estado:</strong> ${r.status}`;
      ul.appendChild(li);
    });
    listDiv.innerHTML = "";
    listDiv.appendChild(ul);
  } catch(e) {
    alert(e.message);
  }
}

document.addEventListener("DOMContentLoaded", loadRequests);
</script>

<h1>Solicitudes de Adopción</h1>
<div id="list">Cargando...</div>
<p><a href="pets.html">Volver</a></p>
</body>
</html>